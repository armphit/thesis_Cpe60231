<div class="panel-body" style="margin-left: 10px; margin-right: 10px;">
  <div>
    กลุ่มเรียน : &nbsp;&nbsp;<mat-form-field style="width: 15%;">
      <mat-label>โปรดเลือกกลุ่มเรียน</mat-label>
      <mat-select required>
        <mat-option
          style="width: auto;"
          *ngFor="let i of dataGroup; let x = index"
          [value]="i.study_group_id"
          (click)="clickGroup(i.study_group_id)"
        >
          {{ i.study_group_name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div *ngIf="codeGroup!">
    <form [formGroup]="advice_year">
      ปีการศึกษา : &nbsp;&nbsp;
      <mat-form-field style="width: 25%;">
        <mat-label>เลือกปีการศึกษา</mat-label>
        <mat-select
          formControlName="_year"
          (selectionChange)="getYearAdvice($event.value)"
          required
        >
          <mat-option *ngFor="let i of range" [value]="i.value">
            {{ i.value }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </div>
</div>
<mat-tab-group>
  <mat-tab label="ข้อมูลการขอคำปรึกษา">
    <table class="table" *ngIf="dataAdvice != null">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ลำดับ</th>
          <th scope="col">ชื่อนักศึกษา</th>
          <th scope="col">เรื่องคำปรึกษา</th>
          <th scope="col">วันที่</th>
          <th scope="col">ตอบกลับคำขอปรึกษา</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i of dataAdvice; let x = index">
          <th scope="row" style="padding-top: 15px;">{{ x + 1 }}</th>
          <td style="padding-top: 15px;">
            {{ i.titlename }}{{ i.fname }}&nbsp;&nbsp;{{ i.lname }}
          </td>
          <td style="padding-top: 15px;">{{ i.subject_advice }}</td>
          <td style="padding-top: 15px;">{{ getDate(i.advice_date) }}</td>

          <td>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-toggle="modal"
              data-target="#reply_advice"
              (click)="clickReply(i)"
            >
              ตอบกลับคำปรึกษา
            </button>
          </td>
          <!-- The Modal -->

          <div class="modal" id="reply_advice">
            <div class="modal-dialog">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h2 class="modal-title">ตอบกลับคำขอปรึกษา</h2>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>

                <!-- Modal body -->
                <form
                  [formGroup]="formAdvice"
                  #formChange="ngForm"
                  (ngSubmit)="formAdvice.valid ? insertReplyAdvice() : ''"
                >
                  <div class="modal-body">
                    <p>
                      <strong>เรื่อง :&nbsp;</strong
                      >{{ dataReply.subject_advice }}
                    </p>
                    <br />
                    <p>
                      <strong>รายละเอียด :<br /></strong>{{ dataReply.detail }}
                    </p>
                    <br />
                    <mat-form-field style="width: 100%;" appearance="fill">
                      <mat-label>ตอบกลับคำขอปรึกษา</mat-label>
                      <textarea
                        matInput
                        formControlName="replyAdvice"
                        rows="3"
                      ></textarea>
                    </mat-form-field>
                    <br />
                  </div>

                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-dismiss="modal"
                    >
                      ยกเลิก
                    </button>
                    <button type="submit" class="btn btn-success">
                      บันทึก
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </tr>
      </tbody>
    </table>
  </mat-tab>
  <mat-tab label="ข้อมูลการตอบคำปรึกษา">
    <table class="table" *ngIf="dataAdvice_notNull != null">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ลำดับ</th>
          <th scope="col">ชื่อนักศึกษา</th>
          <th scope="col">เรื่องคำปรึกษา</th>
          <th scope="col">วันที่</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i of dataAdvice_notNull; let x = index">
          <th scope="row" style="padding-top: 15px;">{{ x + 1 }}</th>
          <td style="padding-top: 15px;">
            {{ i.titlename }}{{ i.fname }}&nbsp;&nbsp;{{ i.lname }}
          </td>
          <td style="padding-top: 15px;">{{ i.subject_advice }}</td>
          <td style="padding-top: 15px;">{{ getDate(i.reply_advice_date) }}</td>
          <td>
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-toggle="modal"
              data-target="#ReplyData"
              (click)="clickReply_data(i)"
            >
              ข้อมูลการตอบคำปรึกษา
            </button>
            &nbsp;&nbsp;
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-toggle="modal"
              data-target="#addAppointment"
              (click)="clickReply_data(i)"
            >
              เพิ่มการนัดหมาย
            </button>
            &nbsp;&nbsp;
            <span (click)="clickUpdateReply(i)">
              <i
                class="fas fa-edit"
                style="font-size: 18px; cursor: pointer;"
                title="แก้ไขข้อมูล"
                data-toggle="modal"
                data-target="#updateAdvice"
              ></i
            ></span>
            &nbsp;&nbsp;
            <span (click)="deleteReplyAdvice(i)"
              ><i
                class="fas fa-trash-alt"
                style="font-size: 18px; color: red; cursor: pointer;"
                title="ลบข้อมูล"
              ></i
            ></span>
          </td>
          <!-- The Modal -->
          <div class="modal" id="ReplyData">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h2 class="modal-title">ข้อมูลการตอบคำปรึกษา</h2>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                  <p>
                    <strong>เรื่อง :&nbsp;</strong
                    >{{ dataReply_id.subject_advice }}
                  </p>
                  <br />
                  <p>
                    <strong>รายละเอียด :<br /></strong>{{ dataReply_id.detail }}
                  </p>
                  <br />
                  <p>
                    <strong>ตอบกลับคำขอปรึกษา :<br /></strong
                    >{{ dataReply_id.reply }}
                  </p>
                  <br />
                  <p>
                    <strong>การนัดหมาย :<br /></strong>
                  </p>
                  <table
                    class="table"
                    *ngIf="dataAppointment_Student != null"
                    style="width: 100%;"
                  >
                    <thead class="thead-dark">
                      <tr>
                        <th scope="col">ลำดับ</th>
                        <th scope="col">
                          ผลที่เกิด/คำแนะนำเพิ่มเติม
                        </th>
                        <th scope="col">หมายเหตุ</th>
                        <th scope="col">วันที่นัดหมาย</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr></tr>
                      <tr
                        *ngFor="let i of dataAppointment_Student; let x = index"
                      >
                        <th scope="row" style="padding-top: 15px;">
                          {{ x + 1 }}
                        </th>
                        <td style="padding-top: 15px;">
                          {{ i.app_suggestion }}
                        </td>
                        <td style="padding-top: 15px;">{{ i.app_detail }}</td>
                        <td style="padding-top: 15px;">
                          {{ getDate(i.app_date) }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <br />
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-danger"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- The Modal -->
          <div class="modal" id="addAppointment">
            <div class="modal-dialog">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h2 class="modal-title">เพิ่มการนัดหมาย</h2>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>
                <form
                  [formGroup]="formAppointment"
                  #formChange="ngForm"
                  (ngSubmit)="formAppointment.valid ? insertAppointment() : ''"
                >
                  <!-- Modal body -->
                  <div class="modal-body">
                    <mat-form-field style="width: 100%;" appearance="fill">
                      <mat-label>ผลที่เกิด/คำแนะนำเพิ่มเติม</mat-label>
                      <textarea
                        matInput
                        formControlName="suggestion"
                        rows="3"
                      ></textarea>
                    </mat-form-field>
                    <br />
                    <mat-form-field style="width: 100%;" appearance="fill">
                      <mat-label>หมายเหตุ</mat-label>
                      <textarea
                        matInput
                        formControlName="detail"
                        rows="3"
                      ></textarea>
                    </mat-form-field>
                    <br />
                    <strong>วันที่นัดหมาย : </strong>&nbsp;&nbsp;
                    <mat-form-field>
                      <mat-label>โปรดเลือกวันที่</mat-label>
                      <input
                        matInput
                        [matDatepicker]="picker"
                        formControlName="to"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-dismiss="modal"
                    >
                      ยกเลิก
                    </button>
                    <button type="submit" class="btn btn-success">
                      บันทึก
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- The Modal -->

          <div class="modal" id="updateAdvice">
            <div class="modal-dialog">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h2 class="modal-title">แก้ไขการตอบคำปรึกษา</h2>
                  <button type="button" class="close" data-dismiss="modal">
                    &times;
                  </button>
                </div>
                <form
                  [formGroup]="formAdvice"
                  #formChange="ngForm"
                  (ngSubmit)="formAdvice.valid ? updateReplyAdvice() : ''"
                >
                  <div class="modal-body">
                    <p>
                      <strong>เรื่อง :&nbsp;</strong
                      >{{ dataUpdateReply.subject_advice }}
                    </p>
                    <br />
                    <p>
                      <strong>รายละเอียด :<br /></strong
                      >{{ dataUpdateReply.detail }}
                    </p>
                    <br />
                    <label for="exampleFormControlTextarea1"
                      >ตอบกลับคำขอปรึกษา</label
                    >
                    <textarea
                      class="form-control"
                      id="exampleFormControlTextarea"
                      rows="3"
                      formControlName="replyAdvice"
                      required
                    ></textarea>
                  </div>

                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-dismiss="modal"
                    >
                      ยกเลิก
                    </button>
                    <button type="submit" class="btn btn-success">
                      บันทึก
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </tr>
      </tbody>
    </table>
  </mat-tab>
  <mat-tab label="ข้อมูลการนัดหมาย">
    <div style="padding-left: 15px;" *ngIf="codeGroup!">
      นักศึกษา : &nbsp;&nbsp;<mat-form-field style="width: 20%;">
        <mat-label>โปรดเลือกนักศึกษา</mat-label>
        <mat-select required>
          <mat-option
            style="width: auto;"
            *ngFor="let i of dataStudent; let x = index"
            [value]="i.userID"
            (click)="clickStudent(i)"
          >
            {{ i.titlename }}{{ i.fname }}&nbsp;&nbsp;{{ i.lname }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <span *ngIf="adviceUser!" style="padding-left: 15px;">
        เรื่องการปรึกษา : &nbsp;&nbsp;<mat-form-field style="width: 40%;">
          <mat-label>โปรดเลือกเรื่องการปรึกษา</mat-label>
          <mat-select required>
            <mat-option
              style="width: auto;"
              *ngFor="let i of dataReply_Student; let x = index"
              [value]="i.reply_advice_id"
              (click)="clickReply_Student(i)"
            >
              <strong>เรื่อง : </strong>{{ i.subject_advice }}&nbsp;&nbsp;{{
                getDate(i.advice_date)
              }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </span>
    </div>

    <table class="table" *ngIf="reply_advice_id != null" style="width: 100%;">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ลำดับ</th>
          <th scope="col">ผลที่เกิด/คำแนะนำเพิ่มเติม</th>
          <th scope="col">หมายเหตุ</th>
          <th scope="col">วันที่</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let i of dataAppointment_Student; let x = index">
          <th scope="row" style="padding-top: 15px;">{{ x + 1 }}</th>
          <td style="padding-top: 15px;">
            {{ i.app_suggestion }}
          </td>
          <td style="padding-top: 15px;">{{ i.app_detail }}</td>
          <td style="padding-top: 15px;">{{ getDate(i.app_date) }}</td>
          <td>
            <span (click)="clickUpdateAppointment(i)">
              <i
                class="fas fa-edit"
                style="font-size: 18px; cursor: pointer;"
                title="แก้ไขข้อมูล"
                data-toggle="modal"
                data-target="#updateAppointment"
              ></i
            ></span>
            &nbsp;&nbsp;
            <span (click)="deleteAppointment(i)"
              ><i
                class="fas fa-trash-alt"
                style="font-size: 18px; color: red; cursor: pointer;"
                title="ลบข้อมูล"
              ></i
            ></span>
          </td>
          <!-- The Modal -->
          <div class="modal" id="updateAppointment">
            <div class="modal-dialog">
              <div class="modal-content">
                <!-- Modal Header -->
                <
                <form
                  [formGroup]="formAppointment"
                  #formChange="ngForm"
                  (ngSubmit)="formAppointment.valid ? updateAppointment() : ''"
                >
                  <!-- Modal body -->
                  <div class="modal-body">
                    <mat-form-field style="width: 100%;" appearance="fill">
                      <mat-label>ผลที่เกิด/คำแนะนำเพิ่มเติม</mat-label>
                      <textarea
                        matInput
                        formControlName="suggestion"
                        rows="3"
                      ></textarea>
                    </mat-form-field>
                    <br />
                    <mat-form-field style="width: 100%;" appearance="fill">
                      <mat-label>หมายเหตุ</mat-label>
                      <textarea
                        matInput
                        formControlName="detail"
                        rows="3"
                      ></textarea>
                    </mat-form-field>
                    <br />
                    <strong>วันที่นัดหมาย : </strong>&nbsp;&nbsp;
                    <mat-form-field>
                      <mat-label>โปรดเลือกวันที่</mat-label>
                      <input
                        matInput
                        [matDatepicker]="picker"
                        formControlName="to"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-dismiss="modal"
                    >
                      ยกเลิก
                    </button>
                    <button type="submit" class="btn btn-success">
                      บันทึก
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </tr>
      </tbody>
    </table>
  </mat-tab>
</mat-tab-group>
